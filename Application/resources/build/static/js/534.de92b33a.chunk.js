"use strict";(self.webpackChunkmyapp=self.webpackChunkmyapp||[]).push([[534],{79534:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Z});var a=r(65043),s=r(33355),n=r(95010),l=r(78507),c=r(29682),i=r(47419),o=r(11645),d=r(85578),u=r(22019),h=r(10898),m=r(2761),A=r(76399),f=r(96651),p=r(3188),g=r(60647),v=r(18125),x=r(85531),j=r(72968),_=r(37490),y=r(50223),S=r(61831),P=r(53722),w=r(75388),E=r(98617),C=r(67407),b=r(61966),z=r(46011),D=r(67177),I=r(38818),k=r(46237),F=r(80599),N=r(62058),B=r(90617),R=r(86213),T=r(94505),M=r(52967),V=r(47489),U=r(53536),H=r(70579);const{Title:O,Text:L}=s.A,{Option:$}=n.A,G=e=>{let{visible:t,onCancel:r,onSubmit:s,initialValues:u,mode:h}=e;const[m]=l.A.useForm();(0,a.useEffect)((()=>{t&&(m.resetFields(),u&&m.setFieldsValue(u))}),[t,u,m]);return(0,H.jsx)(c.A,{title:"edit"===h?"Edit User":"Add New User",open:t,onCancel:r,onOk:async()=>{try{const e=await m.validateFields();await s(e),m.resetFields()}catch(e){console.error("Validation failed:",e)}},width:600,children:(0,H.jsxs)(l.A,{form:m,layout:"vertical",initialValues:{role:"SALESPERSON",reg_status:"PENDING"},children:[(0,H.jsxs)(i.A,{gutter:16,children:[(0,H.jsx)(o.A,{span:12,children:(0,H.jsx)(l.A.Item,{name:"staff_id",label:"Staff ID",validateTrigger:["onBlur","onChange"],rules:[{validator:async(e,t)=>{if("edit"===h)return Promise.resolve();if(!t)return Promise.reject("Please input your Staff ID!");if(t.startsWith("0"))return Promise.reject("Staff ID cannot start with 0");if(!/^[a-zA-Z0-9]+$/.test(t))return Promise.reject("Staff ID can only contain letters and numbers");if(t.length<4)return Promise.reject("Staff ID must be at least 4 characters long");try{return(await R.A.post("https://mcws.mooo.com/api/check-staff-id",{staff_id:t},{headers:{Accept:"application/json","Content-Type":"application/json"}})).data.exists?Promise.reject("This Staff ID is already in use"):Promise.resolve()}catch(r){return Promise.reject("Error checking Staff ID availability")}}}],hasFeedback:!0,children:(0,H.jsx)(d.A,{prefix:(0,H.jsx)(S.A,{}),placeholder:"Staff ID",maxLength:20,onInput:e=>{e.target.value=e.target.value.replace(/[^a-zA-Z0-9]/g,"").replace(/^0+/,"")},disabled:"edit"===h})})}),(0,H.jsx)(o.A,{span:12,children:(0,H.jsx)(l.A.Item,{name:"username",label:"Username",validateTrigger:["onBlur","onChange"],rules:[{validator:async(e,t)=>{if("edit"===h&&t===u.username)return Promise.resolve();if(!t)return Promise.reject("Please input your username!");if(!/^[a-zA-Z0-9_]+$/.test(t))return Promise.reject("Username can only contain letters, numbers, and underscores");if(t.length<3)return Promise.reject("Username must be at least 3 characters long");try{return(await R.A.post("https://mcws.mooo.com/api/check-username",{username:t},{headers:{Accept:"application/json","Content-Type":"application/json"}})).data.exists?Promise.reject("This Username is already in use"):Promise.resolve()}catch(r){return Promise.reject("Error checking Username availability")}}}],hasFeedback:!0,children:(0,H.jsx)(d.A,{prefix:(0,H.jsx)(P.A,{}),placeholder:"Username",maxLength:30,onInput:e=>{e.target.value=e.target.value.replace(/[^a-zA-Z0-9_]/g,"")}})})})]}),(0,H.jsx)(l.A.Item,{name:"email",label:"Email",validateTrigger:["onBlur","onChange"],rules:[{validator:async(e,t)=>{if(!t)return Promise.reject("Please input your email");if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t))return Promise.reject("Please enter a valid email address!");if("edit"===h&&t===u.email)return Promise.resolve();try{return(await R.A.post("https://mcws.mooo.com/api/check-email",{email:t},{headers:{Accept:"application/json","Content-Type":"application/json"}})).data.exists?Promise.reject("This email is already registered"):Promise.resolve()}catch(r){return Promise.reject("Error checking email availability")}}}],hasFeedback:!0,children:(0,H.jsx)(d.A,{prefix:(0,H.jsx)(w.A,{}),placeholder:"Email",maxLength:50})}),"edit"!==h&&(0,H.jsx)(l.A.Item,{name:"password",label:"Password",validateTrigger:["onBlur","onChange"],rules:[{required:!0,message:"Please input password"},{min:8,message:"Password must be at least 8 characters"}],hasFeedback:!0,children:(0,H.jsx)(d.A.Password,{prefix:(0,H.jsx)(E.A,{})})}),(0,H.jsxs)(i.A,{gutter:16,children:[(0,H.jsx)(o.A,{span:12,children:(0,H.jsx)(l.A.Item,{name:"role",label:"Role",validateTrigger:["onBlur","onChange"],hasFeedback:!0,rules:[{required:!0,message:"Please select role"}],children:(0,H.jsxs)(n.A,{children:[(0,H.jsx)($,{value:"SALESPERSON",children:"Salesperson"}),(0,H.jsx)($,{value:"OFFICE_STAFF",children:"Office Staff"})]})})}),(0,H.jsx)(o.A,{span:12,children:(0,H.jsx)(l.A.Item,{name:"reg_status",label:"Status",validateTrigger:["onBlur","onChange"],hasFeedback:!0,rules:[{required:!0,message:"Please select status"}],children:(0,H.jsxs)(n.A,{children:[(0,H.jsx)($,{value:"PENDING",children:"Pending"}),(0,H.jsx)($,{value:"APPROVED",children:"Approved"}),(0,H.jsx)($,{value:"REJECTED",children:"Rejected"})]})})})]})]})})},Z=()=>{const[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)(!1),[n,l]=(0,a.useState)(""),[c,S]=(0,a.useState)(!1),[w,E]=(0,a.useState)(null),R=(0,a.useRef)({current:1,pageSize:10,total:0}),[$,Z]=(0,a.useState)({reg_status:void 0,role:void 0}),[q,J]=(0,a.useState)({total:0,approved:0,pending:0,rejected:0}),K=(0,a.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(!0);try{const a={page:e.current||R.current.current,per_page:e.pageSize||R.current.pageSize,search:void 0!==e.search?e.search:n,reg_status:e.reg_status||$.reg_status,role:e.role||$.role,sort_field:e.sort_field,sort_direction:e.sort_direction},s=await T.Ay.get("/users",{params:a});if(s.data){var r;t(s.data.data),R.current={...R.current,current:Number(s.data.current_page),total:Number(s.data.total)};const e=await T.Ay.get("/users",{params:{per_page:9999,search:a.search,reg_status:a.reg_status,role:a.role}});if(null!==(r=e.data)&&void 0!==r&&r.data){const t=e.data.data;J({total:t.length,approved:t.filter((e=>"APPROVED"===e.reg_status)).length,pending:t.filter((e=>"PENDING"===e.reg_status)).length,rejected:t.filter((e=>"REJECTED"===e.reg_status)).length})}}}catch(a){console.error("Error fetching users:",a),u.Ay.error("Failed to fetch users")}finally{s(!1)}}),[n,$]);(0,a.useEffect)((()=>{K()}),[K]);const Q=(0,a.useRef)((0,U.debounce)((e=>{l(e),R.current.current=1,K({current:1,search:e})}),300)).current,X=e=>{Q(e)},W=e=>({APPROVED:"green",PENDING:"gold",REJECTED:"red"}[e]||"default"),Y=e=>({ADMIN:"purple",SALESPERSON:"blue",OFFICE_STAFF:"cyan"}[e]||"default"),ee=[{title:"User",key:"user",render:(e,t)=>(0,H.jsxs)(h.A,{children:[(0,H.jsx)(m.A,{icon:(0,H.jsx)(P.A,{}),style:{backgroundColor:"default"===Y(t.role)?"#1890ff":void 0},className:`avatar-${Y(t.role)}`}),(0,H.jsxs)(h.A,{direction:"vertical",size:0,children:[(0,H.jsx)(L,{strong:!0,children:t.username}),(0,H.jsx)(L,{type:"secondary",style:{fontSize:"12px"},children:t.staff_id})]})]})},{title:"Email",dataIndex:"email"},{title:"Role",dataIndex:"role",render:e=>(0,H.jsx)(A.A,{color:Y(e),children:e}),filters:[{text:"Salesperson",value:"SALESPERSON"},{text:"Office Staff",value:"OFFICE_STAFF"}],filterMultiple:!1,filteredValue:$.role?[$.role]:null},{title:"Status",dataIndex:"reg_status",render:e=>(0,H.jsx)(A.A,{color:W(e),children:e}),filters:[{text:"Approved",value:"APPROVED"},{text:"Pending",value:"PENDING"},{text:"Rejected",value:"REJECTED"}],filterMultiple:!1,filteredValue:$.reg_status?[$.reg_status]:null},{title:"Actions",key:"actions",render:(e,t)=>(0,H.jsxs)(h.A,{children:[(0,H.jsx)(f.A,{title:"Edit",children:(0,H.jsx)(p.Ay,{className:M.A.ActionButton,icon:(0,H.jsx)(C.A,{}),onClick:()=>{E(t),S(!0)}})}),(0,H.jsx)(g.A,{title:"Delete User",description:"Are you sure you want to delete this user?",onConfirm:()=>(async e=>{try{await T.Ay.delete(`/users/${e}`),u.Ay.success("User deleted successfully"),K()}catch(t){console.error("Error deleting user:",t),u.Ay.error("Failed to delete user")}})(t.staff_id),okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},children:(0,H.jsx)(f.A,{title:"Delete",children:(0,H.jsx)(p.Ay,{danger:!0,icon:(0,H.jsx)(b.A,{}),className:M.A.DeleteButton})})})]})}];return(0,H.jsx)("div",{style:{padding:24,minHeight:"100vh",background:"#f5f5f5"},children:(0,H.jsxs)(h.A,{direction:"vertical",size:"large",style:{width:"100%"},children:[(0,H.jsx)(v.A,{items:[{title:(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(z.A,{})," Home"]})},{title:"User Management"}]}),(0,H.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,H.jsx)(O,{level:2,children:"User Management"}),(0,H.jsx)(p.Ay,{className:M.A.ActionButton,icon:(0,H.jsx)(D.A,{}),onClick:()=>{E(null),S(!0)},children:"Add User"})]}),(0,H.jsxs)(i.A,{gutter:[16,16],children:[(0,H.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,H.jsx)(x.A,{hoverable:!0,className:V.A.CardDetails,children:(0,H.jsx)(j.A,{title:(0,H.jsxs)(h.A,{children:[(0,H.jsx)(I.A,{})," Total Users"]}),value:q.total,valueStyle:{color:"#1890ff"}})})}),(0,H.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,H.jsx)(x.A,{hoverable:!0,className:V.A.CardDetails,children:(0,H.jsx)(j.A,{title:(0,H.jsxs)(h.A,{children:[(0,H.jsx)(k.A,{})," Approved"]}),value:q.approved,valueStyle:{color:"#52c41a"}})})}),(0,H.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,H.jsx)(x.A,{hoverable:!0,className:V.A.CardDetails,children:(0,H.jsx)(j.A,{title:(0,H.jsxs)(h.A,{children:[(0,H.jsx)(_.A,{status:"processing"}),"Pending"]}),value:q.pending,valueStyle:{color:"#faad14"}})})}),(0,H.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,H.jsx)(x.A,{hoverable:!0,className:V.A.CardDetails,children:(0,H.jsx)(j.A,{title:(0,H.jsxs)(h.A,{children:[(0,H.jsx)(F.A,{})," Rejected"]}),value:q.rejected,valueStyle:{color:"#ff4d4f"}})})})]}),(0,H.jsx)(x.A,{children:(0,H.jsxs)(h.A,{direction:"vertical",size:"middle",style:{width:"100%",padding:"1%"},children:[(0,H.jsxs)(h.A,{wrap:!0,children:[(0,H.jsx)(d.A.Search,{placeholder:"Search users...",allowClear:!0,enterButton:(0,H.jsx)(p.Ay,{icon:(0,H.jsx)(N.A,{}),type:"primary",children:"Search"}),onSearch:X,onChange:e=>X(e.target.value),style:{width:300}}),(0,H.jsx)(p.Ay,{className:M.A.ActionButton,icon:(0,H.jsx)(B.A,{}),onClick:()=>(R.current.current=1,void K({current:1})),children:"Refresh"})]}),(0,H.jsx)(y.A,{columns:ee,dataSource:e,rowKey:"staff_id",loading:r,pagination:{current:R.current.current,pageSize:R.current.pageSize,total:R.current.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} users`,pageSizeOptions:["10","20","50","100"]},onChange:(e,t,r)=>{var a,s;const n={reg_status:null===(a=t.reg_status)||void 0===a?void 0:a[0],role:null===(s=t.role)||void 0===s?void 0:s[0]};Z(n),R.current={...R.current,current:e.current,pageSize:e.pageSize},K({current:e.current,pageSize:e.pageSize,sort_field:r.field,sort_direction:"ascend"===r.order?"asc":"desc",...n})},scroll:{x:1e3},className:"user-management-table"})]})}),(0,H.jsx)(G,{visible:c,onCancel:()=>{S(!1),E(null)},onSubmit:async e=>{try{w?(await T.Ay.put(`/users/${w.staff_id}`,e),u.Ay.success("User updated successfully")):(await T.Ay.post("/users",e),u.Ay.success("User added successfully")),S(!1),E(null),K()}catch(t){console.error("Error saving user:",t),u.Ay.error("Failed to save user")}},initialValues:w,mode:w?"edit":"add"})]})})}},94505:(e,t,r)=>{r.d(t,{Ay:()=>l});var a=r(86213);const s=a.A.create({baseURL:"https://mcws.mooo.com/api",withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}});s.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e))),s.interceptors.response.use((e=>e),(e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),window.location="/login"),Promise.reject(e))));const n=localStorage.getItem("token");n&&(a.A.defaults.headers.common.Authorization=`Bearer ${n}`);const l=s},61966:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(58168),s=r(65043);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};var l=r(51835),c=function(e,t){return s.createElement(l.A,(0,a.A)({},e,{ref:t,icon:n}))};const i=s.forwardRef(c)},61831:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(58168),s=r(65043);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136V232h752v560zM610.3 476h123.4c1.3 0 2.3-3.6 2.3-8v-48c0-4.4-1-8-2.3-8H610.3c-1.3 0-2.3 3.6-2.3 8v48c0 4.4 1 8 2.3 8zm4.8 144h185.7c3.9 0 7.1-3.6 7.1-8v-48c0-4.4-3.2-8-7.1-8H615.1c-3.9 0-7.1 3.6-7.1 8v48c0 4.4 3.2 8 7.1 8zM224 673h43.9c4.2 0 7.6-3.3 7.9-7.5 3.8-50.5 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H522a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.6-126.1a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1c-.4 4.6 3.2 8.4 7.8 8.4zm149-262c28.5 0 51.7 23.3 51.7 52s-23.2 52-51.7 52-51.7-23.3-51.7-52 23.2-52 51.7-52z"}}]},name:"idcard",theme:"outlined"};var l=r(51835),c=function(e,t){return s.createElement(l.A,(0,a.A)({},e,{ref:t,icon:n}))};const i=s.forwardRef(c)},98617:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(58168),s=r(65043);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};var l=r(51835),c=function(e,t){return s.createElement(l.A,(0,a.A)({},e,{ref:t,icon:n}))};const i=s.forwardRef(c)},75388:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(58168),s=r(65043);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};var l=r(51835),c=function(e,t){return s.createElement(l.A,(0,a.A)({},e,{ref:t,icon:n}))};const i=s.forwardRef(c)},80599:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(58168),s=r(65043);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"};var l=r(51835),c=function(e,t){return s.createElement(l.A,(0,a.A)({},e,{ref:t,icon:n}))};const i=s.forwardRef(c)},67177:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(58168),s=r(65043);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"};var l=r(51835),c=function(e,t){return s.createElement(l.A,(0,a.A)({},e,{ref:t,icon:n}))};const i=s.forwardRef(c)},52967:(e,t,r)=>{r.d(t,{A:()=>a});const a={"fade-in":"App_fade-in__8IP91",show:"App_show__YgTh4",ActionButton:"App_ActionButton__SVqGL",DeleteButton:"App_DeleteButton__ffM0l"}},47489:(e,t,r)=>{r.d(t,{A:()=>a});const a={UserManagement:"user_UserManagement__mKEwF",flexBox:"user_flexBox__ccfvQ",CardDetails:"user_CardDetails__CQbXj","modal-leave":"user_modal-leave__HoNL3","modal-closing":"user_modal-closing__sVt3t","ant-modal-content":"user_ant-modal-content__mtDrH",modalFadeOut:"user_modalFadeOut__WMB7r",userDetailsModal:"user_userDetailsModal__d8dGA",closing:"user_closing__vcXEV",userCard:"user_userCard__uDcKX"}}}]);
//# sourceMappingURL=534.de92b33a.chunk.js.map